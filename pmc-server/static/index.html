<html>
    <head>
        <meta http-Equiv="Cache-Control" Content="no-cache" />
        <meta http-Equiv="Pragma" Content="no-cache" />
        <meta http-Equiv="Expires" Content="0" />
        <link rel="import" href="pmc-top-nav.html">
        <link rel="import" href="pmc-main-editor.html">
        <link rel="import" href="pmc-helper.html">


        <!-- Handle SSE events from the server-->
        <script>
            var evtSrc = new EventSource("/streamplant");
            //Changed values are received in json format
            evtSrc.onmessage = function(e) {
                var jsonPlantVariables = $.parseJSON(e.data);
                var plantVariables = jsonPlantVariables["plantVariables"];
                for (var i in plantVariables) {
                    var pv = plantVariables[i];
                    var pvName = pv.plantId + "::" + pv.variableId;
                    var targetElement = allPMCComponents[pvName];
                    if (targetElement !== undefined) {
                        targetElement.setPlantValue(pv.value);
                    }
                }
            };
        </script>
        <script>
            var evtSrc = new EventSource("/streamschedule");
            //Changed values are received in json format
            evtSrc.onmessage = function(e) {
                var jsonScheduleVariables = $.parseJSON(e.data);
                var scheduleVariables = jsonScheduleVariables["scheduleVariables"];
                for (var i in scheduleVariables) {
                    var pv = scheduleVariables[i];
                    var pvName = pv.plantId + "::" + pv.variableId;
                    if (pv.scheduleId === currentScheduleId) {
                        var targetElement = allPMCComponents[pvName];
                        if (targetElement !== undefined) {
                            targetElement.setTriggerRemoteUpdate(false);
                            targetElement.setValue(pv.value);
                            targetElement.setTriggerRemoteUpdate(true);
                        }
                    }
                }
            };
        </script>

    </head>
    <body>
        <table style="width:100%">
            <tr>
                <td style="border-style:solid;border-width:1px;background:#353535;">
                    <pmc-top-nav data-plant-id="PLANT1"></pmc-top-nav>
                </td>
            </tr>
            <tr>
                <td style="border-style:solid;border-width:1px">
                    <pmc-main-editor data-template-url="ps-example-1.html"/></pmc-main-editor>
                </td>
            </tr>
        </table>
   </body>
</html>

