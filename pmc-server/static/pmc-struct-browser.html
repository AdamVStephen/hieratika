<html>
    <head>
        <link rel="import" href="libraries.html">
        <link rel="import" href="pmc-component.html">
        <link rel="import" href="pmc-input.html">
    </head>
    <body>
        <template id="tstructbrowser">
            <div id="dstructbrowser"></div>
        </template>

        <script>
            //This is enclosure is required to protect the importDoc
            (function () {
                var importDoc = document.currentScript.ownerDocument; // importee
                //Constructor
                class PMCStructBrowser extends PMCComponent {
                    constructor() {
                        super();
                    }

                    createdCallback () {
                        super.createdCallback();
                        this.mainDiv = this.shadowRoot.querySelector("#dstructbrowser");

                        this.privateStructIds = ["numberOfElements", "validation", "permissions"];
                    }
                    
                    getTemplate() {
                        var template = importDoc.querySelector("#tstructbrowser");
                        return template;
                    }

                    addMember(member) {
                        if (Array.isArray(member)) {
                            if (!this.privateStructIds.includes(memberId)) {
                                this.mainDiv.innerHTML += "<ul>\n";
                                for (var i in member) {
                                    this.mainDiv.innerHTML += "<li>\n";
                                    this.mainDiv.innerHTML += i + " ";
                                    this.addMember(member[i]);
                                    this.mainDiv.innerHTML += "</li>\n";
                                }
                                this.mainDiv.innerHTML += "</ul>\n";
                            }
                        }
                        else {
                            var memberId = member["variableId"];
                            if (memberId !== undefined) {
                                var isStruct = member["isStruct"];
                                if (isStruct === true) {
                                    var membersIds = Object.keys(member);
                                    this.mainDiv.innerHTML += "<ul>\n";
                                    this.mainDiv.innerHTML += "<li>\n";
                                    this.mainDiv.innerHTML += memberId + ": ";
                                    for (var i in membersIds) {
                                        this.addMember(member[membersIds[i]]);
                                    } 
                                    this.mainDiv.innerHTML += "</li>\n";
                                    this.mainDiv.innerHTML += "</ul>\n";
                                }
                                else {
                                    this.mainDiv.innerHTML += "<li>\n";
                                    this.mainDiv.innerHTML += memberId + ": <pmc-input id=\"" + memberId + "\" name=\"" + memberId + "\">\n";
                                    this.mainDiv.innerHTML += "</li>\n";
                                }
                            }
                        }
                    }

                    infoLoaded () {
                        this.mainDiv.innerHTML = "";
                        this.variableId = this.id;
                        this.addMember(this);
                    }
                }
                document.registerElement("pmc-struct-browser", {
                    prototype: PMCStructBrowser.prototype,
                });
            })(); 
        </script>
    </body>
</html>
