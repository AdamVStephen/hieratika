<html>
    <head>
        <link rel="import" href="libraries.html">
        <link rel="import" href="pmc-component.html">
        <link rel="import" href="libraries.html">
        <link rel="import" href="pmc-input.html">
        <link rel="import" href="pmc-array-editor.html">
        <link rel="import" href="pmc-filter-editor.html">
        <link rel="import" href="pmc-library-button.html">
        <link rel="import" href="pmc-cubicle-editor.html">
        <link rel="import" href="pmc-switch.html">
        <link rel="import" href="pmc-switch-editor.html">

    </head>
    <body>
        <template id="tmaineditor">
            <div id="dmaineditor">
            </div>
        </template>

        <script>
            //This is enclosure is required to protect the importDoc
            (function () {
                var importDoc = document.currentScript.ownerDocument; // importee
                //Constructor
                class PMCMainEditor extends HTMLElement {
                    constructor() {
                        super();
                    }

                    createdCallback () {
                        var template = importDoc.querySelector("#tmaineditor");
                        var clone = document.importNode(template.content, true);
                        var root = this.createShadowRoot();
                        root.appendChild(clone);

                        var topNav = document.getElementById("top-nav");
                        topNav.addPageListener(this); 
                        topNav.addUserLogoutListener(this);
                    }

                    pageChanged (page) {
                        var pageUrl = page.id + ".html?" + new Date().getTime(); //new Date... to force reloading with no caching
                        var templateDiv = this.shadowRoot.querySelector("#dmaineditor");
                        if (pageUrl !== undefined) {
                            var httpRequest = new XMLHttpRequest();
                            httpRequest.onreadystatechange = function() {
                                if (this.readyState == 4 && this.status == 200) {
                                    allPMCComponents = {};

                                    templateDiv.innerHTML = this.responseText;

                                    getPlantInfo(); 

                                    $.each(allPMCComponents, function (i, pmcComp) {
                                        pmcComp.domLoaded();
                                    });
                                }
                            };
                            httpRequest.open("GET", pageUrl , true);
                            httpRequest.send();
                        }
                    }
    
                    userLogout () {
                        var templateDiv = this.shadowRoot.querySelector("#dmaineditor");
                        templateDiv.innerHTML = "";
                    }
                }
                document.registerElement("pmc-main-editor", {
                    prototype: PMCMainEditor.prototype,
                });
            })(); 
        </script>
    </body>
</html>
