<html>
    <head>
        <link rel="import" href="libraries.html">
        <link rel="import" href="htk-abstract-input.html">
    </head>
    <body>
        <template id="tenum">
            <select id="tselect" name="tselect">
            </select>
        </template>

        <script>
            //This is enclosure is required to protect the importDoc
            (function () {
                var importDoc = document.currentScript.ownerDocument; // importee
                //Constructor
                class HtkEnum extends HtkAbstractInput {
                    constructor() {
                        super();
                    }

                    createdCallback () {
                        super.createdCallback();
                        this.select = this.shadowRoot.querySelector("#tselect");
                        this.select.addEventListener("input", function (e) {
                            var selectedValue = this.select[this.select.selectedIndex].value;
                            this.setValue(selectedValue);
                        }.bind(this));
                        this.choices = [];
                    }
                    
                    getTemplate() {
                        var template = importDoc.querySelector("#tenum");
                        return template;
                    }

                    setVariable (variable) {
                        super.setVariable(variable);
                        if ("choices" in variable) {
                            this.setChoices(variable.choices);
                        }   
                    }

                    setChoices(choices) {
                        this.choices = choices;
                        this.select.innerHTML = "";
                        for (var i=0; i<this.choices.length; i++) {
                            var option = document.createElement("option");
                            option.text = choices[i];
                            option.value = choices[i];
                            this.select.appendChild(option);
                        }
                        this.select.value = this.getValue();
                    }

                    getChoices () {
                        return this.choices;
                    }

                    refresh() {
                        this.select.value = this.value;
                        this.checkValues(this.select);
                    }

                    setReadOnly (isReadOnly) {
                        super.setReadOnly(isReadOnly);
                        this.select.disabled = isReadOnly;
                    }

                }
                document.registerElement("htk-enum", {
                    prototype: HtkEnum.prototype,
                });
            })(); 
        </script>
    </body>
</html>
